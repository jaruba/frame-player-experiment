
<html>
  <head>
    <title>Stream</title>
    <style>
        html, body, video {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: black;
        }
    </style>
  </head>

  <body>
    <script src="./hls.js"></script>

    <center>
      <video id="video"></video>
    </center>

    <script>
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, '\\$&');
            var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
                results = regex.exec(url);
            if (!results) return null;
            if (!results[2]) return '';
            return decodeURIComponent(results[2].replace(/\+/g, ' '));
        }
      var video = document.getElementById('video');
      if (Hls.isSupported()) {
        var hls = new Hls({
          debug: true,
        });
        hls.loadSource(getParameterByName('stream'));
        hls.attachMedia(video);
        hls.on(Hls.Events.MEDIA_ATTACHED, function () {
          video.muted = true;
          video.play();
        });
      }
      else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = getParameterByName('stream');
        video.addEventListener('canplay', function () {
          video.play();
        });
      }
        function sendBuffering() {
            window.parent.postMessage({ propName: 'buffering', propValue: video.readyState < video.HAVE_FUTURE_DATA }, '*');
        };
        function sendBuffered() {
            var time = video.currentTime !== null && isFinite(video.currentTime) ? video.currentTime : 0;
            for (var i = 0; i < video.buffered.length; i++) {
                if (video.buffered.start(i) <= time && time <= video.buffered.end(i)) {
                    window.parent.postMessage({ propName: 'buffered', propValue: Math.floor(video.buffered.end(i) * 1000) }, '*');
                    return;
                }
            }
            window.parent.postMessage({ propName: 'buffered', propValue: Math.floor(time * 1000) }, '*');
        }
        video.onpause = function() {
            window.parent.postMessage({ propName: 'paused', propValue: !!video.paused }, '*');
        };
        video.onplay = function() {
            window.parent.postMessage({ propName: 'paused', propValue: !!video.paused }, '*');
        };
        video.ontimeupdate = function() {
            var time = video.currentTime !== null && isFinite(video.currentTime) ? video.currentTime : 0;
            if (time) {
                window.parent.postMessage({ propName: 'time', propValue: time }, '*');
            }
            sendBuffered()
        };
        video.onwaiting = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onseeking = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onseeked = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onstalled = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onplaying = function() {
            sendBuffering()
            sendBuffered()
        };
        video.oncanplay = function() {
            sendBuffering()
            sendBuffered()
        };
        video.ondurationchange = function() {
            window.parent.postMessage({ propName: 'duration', propValue: Math.floor(video.duration * 1000) }, '*');
        };
        video.canplaythrough = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onloadeddata = function() {
            sendBuffering()
            sendBuffered()
        };
        video.onvolumechange = function() {
            window.parent.postMessage({ propName: 'volume', propValue: Math.floor(video.volume * 100) }, '*');
            window.parent.postMessage({ propName: 'muted', propValue: !!video.muted }, '*');
        };
        video.onratechange = function() {
            if (video.playbackRate === null || !isFinite(video.playbackRate)) {
                return null;
            }

            window.parent.postMessage({ propName: 'playbackSpeed', propValue: video.playbackRate }, '*');
        };

        var eventMethod = window.addEventListener ? "addEventListener" : "attachEvent";
        var eventer = window[eventMethod];
        var messageEvent = eventMethod == "attachEvent" ? "onmessage" : "message";

        eventer(messageEvent,function(e) {
            console.log('message event')
            source = e.source;
            var key = e.message ? "message" : "data";
            var data = e[key];
            if ((data || {}).propName) {
                switch (data.propName) {
                    case 'paused': {
                        data.propValue ? video.pause() : video.play();

                        break;
                    }
                    case 'time': {
                        if (data.propValue !== null && isFinite(data.propValue)) {
                            video.currentTime = parseInt(data.propValue, 10) / 1000;
                        }

                        break;
                    }
                    case 'volume': {
                        if (data.propValue !== null && isFinite(data.propValue)) {
                            video.muted = false;
                            video.volume = Math.max(0, Math.min(100, parseInt(data.propValue, 10))) / 100;
                        }

                        break;
                    }
                    case 'muted': {
                        video.muted = !!data.propValue;
                        break;
                    }
                    case 'playbackSpeed': {
                        if (data.propValue !== null && isFinite(data.propValue)) {
                            video.playbackRate = parseFloat(data.propValue);
                        }

                        break;
                    }
                }
            }
        }, false);
    </script>
<div style="position: absolute; top: 5px; right: 5px;">
</div></body>
</html>